<html>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
crossorigin=""/>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
crossorigin=""></script>

<script src='//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.3.1/leaflet-omnivore.min.js'></script>

<body>
<div id='map' style='height:550px; width: 1000px;'></div>

<script>

// global variables //
var OneMap_Token = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOjgxMTAsInVzZXJfaWQiOjgxMTAsImVtYWlsIjoia2VpdGgubG9vQGdhdGVjaC5lZHUiLCJmb3JldmVyIjpmYWxzZSwiaXNzIjoiaHR0cDpcL1wvb20yLmRmZS5vbmVtYXAuc2dcL2FwaVwvdjJcL3VzZXJcL3Nlc3Npb24iLCJpYXQiOjE2MzU4MjczMzEsImV4cCI6MTYzNjI1OTMzMSwibmJmIjoxNjM1ODI3MzMxLCJqdGkiOiI3ZDRjMjYzOTg2NWY2YjUyMTMxYWI4NGU3MDIzMTgxZiJ9.1hAkQfZUTY1LsAqIKoi0lbXqYi3jCnIgkK3XBFaw34c"

// testing variables //
var testSearch = "J Gateway"
var testlocationXY = {x: 26196.0124962935, y: 30258.525668541, name: "Artra"} //"X":"26196.0124962935","Y":"30258.525668541"
var testlocationLatLong1 = {latitude: 1.2901276549478262, longitude: 103.81655234786841, name: "Artra", price: 1700000} //"LATITUDE":"1.2901276549478262","LONGITUDE":"103.81655234786841
var testlocationLatLong2 = {latitude: 1.33555731797921, longitude: 103.742416815373, name: "J Gateway", price: 1200000} //"LATITUDE":"1.33555731797921","LONGITUDE":"103.742416815373"
var testTheme = "kindergartens"
var tempLatLong = {latitude: 1.2901276549478262, longitude: 103.81655234786841, name: "Artra", road: "Alexandra View"}

// icon variables //
var hse_icon = L.icon({
    iconUrl: "icons/hse.jpg",
    iconSize: [25, 25], // size of the icon
    //iconAnchor:   [40, 40], // point of the icon which will correspond to marker's location
    //popupAnchor:  [50, 50] // point from which the popup should open relative to the iconAnchor
});
var sch_icon = L.icon({
    iconUrl: "icons/sch.png",
    iconSize: [20, 20], // size of the icon
});
var mall_icon = L.icon({
    iconUrl: "icons/mall.png",
    iconSize: [20, 20], // size of the icon
});
var mkt_icon = L.icon({
    iconUrl: "icons/mkt.jpg",
    iconSize: [20, 20], // size of the icon
});

// OneMap APIs //
function nameSearch(){
    $.ajax({
        url: "https://developers.onemap.sg/commonapi/search?searchVal="+testSearch+"&returnGeom=Y&getAddrDetails=Y&pageNum=1",
        success: function(result) {
        var TrueResult = JSON.stringify(result); //Set result to a variable for writing
        console.log(TrueResult); //document.write(TrueResult);
    }});
}

function GeoXY(){
    $.ajax({
        url: "https://developers.onemap.sg/privateapi/commonsvc/revgeocodexy?location="+testlocationXY.x+","+testlocationXY.y+"&token="+OneMap_Token+"&buffer=10&addressType=all",
        success: function(result){
        var TrueResult = JSON.stringify(result); //Set result to a variable for writing
        console.log(TrueResult); //document.write(TrueResult);
    }});                  
}

function GeoLatLong(input, PopUp_flag){
    $.ajax({
        url: "https://developers.onemap.sg/privateapi/commonsvc/revgeocode?location="+input.latitude+","+input.longitude+"&token="+OneMap_Token+"&buffer=10&addressType=all",
        success: function(result){
            var TrueResult = JSON.stringify(result); //Set result to a variable for writing
            //console.log(TrueResult); //document.write(TrueResult);
            console.log(result.GeocodeInfo[0].BUILDINGNAME);
            
            var position = {
                latitude: input.latitude,
                longitude: input.longitude,
                name: result.GeocodeInfo[0].BUILDINGNAME
            };
            if (PopUp_flag == 1) { showPopUp(position); }
        }
    });
}

// functions //
function onEachFeature (feature, layer) {
    layer.bindPopup("Name: <b>" + feature.properties.name + "</b>");
}

function pointToLayer (feature, latlng) {
    switch (feature.properties.description) {
        case "Property": return L.marker(latlng, {icon: hse_icon});
        case "School": return L.marker(latlng, {icon: sch_icon});
        case "Mall": return L.marker(latlng, {icon: mall_icon});
        case "Market": return L.marker(latlng, {icon: mkt_icon});
    }
}

function onClick(e) {
    if (features_layer == null) {
        showFeatures(e.sourceTarget.feature.properties.item)
    }
    else {
        hideFeatures()
        showFeatures(e.sourceTarget.feature.properties.item)
    }    
}

function showFeatures(item) {
    features_layer = L.geoJSON(testGeoJSon_properties, {
        onEachFeature: onEachFeature,
        pointToLayer: pointToLayer,
        filter: function(feature, layer) {
            if (feature.properties.item == item && feature.properties.description != "Property") return true;
        }
    }).addTo(map);
}

function hideFeatures() {
    map.removeLayer(features_layer);
}

// global variables //
var testGeoJSon_properties = [
    // #1 Property //
    {
        "type": "Feature",
        "properties": {
            "item": 1,
            "description": "Property",
            "name": "FORTE SUITES", // "popupContent": "#1 Property"
            "show_on_map": true
        },
        "geometry": {
            "type": "Point",
            "coordinates": [103.8519705, 1.317827996]
        }
    },

    {
        "type": "Feature",
        "properties": {
            "item": 1,
            "description": "Mall",
            "name": "City Square Mall",
            "show_on_map": true
        },
        "geometry": {
            "type": "Point",
            "coordinates": [103.8561608, 1.3114516]
        }
    },
    
    // #2 Property //
    {
        "type": "Feature",
        "properties": {
            "item": 2,
            "description": "Property",
            "name": "CITYSCAPE @FARRER PARK",
            "show_on_map": true
        },
        "geometry": {
            "type": "Point",
            "coordinates": [103.8515937, 1.318021994]
        }
    },

    {
        "type": "Feature",
        "properties": {
            "item": 2,
            "description": "Mall",
            "name": "100 AM",
            "show_on_map": true
        },
        "geometry": {
            "type": "Point",
            "coordinates": [103.8435656, 1.2750063]
        }
    }
];
var features_visible = false
var features_layer

// map variables //
var default_map = L.tileLayer("https://maps-{s}.onemap.sg/v3/Default/{z}/{x}/{y}.png", {detectRetina: true, maxZoom: 18, minZoom: 11});
var map = L.map('map', {center: [1.355, 103.81], zoom: 12 }); //layers: [default_map]

// layer variables //
var base_maps = { "Default": default_map };
var overlay_maps = {}; //var overlayMaps = { //"Boundaries" : boundaries, //"Locations": locations };

//var area_layer = L.geoJSON(null, {onEachFeature: onEachFeature, style: onEachStyle}).addTo(map);

var property_layer = L.geoJSON(testGeoJSon_properties, {
    onEachFeature: onEachFeature,
    pointToLayer: pointToLayer,
    filter: function(feature, layer) {
        if (feature.properties.description == "Property") return true;
    }   
}).on('click', onClick)

default_map.addTo(map);
property_layer.addTo(map);


//L.geoJSON(testGeoJSon_property1).addTo(map);



//var property_layer = L.geoJSON().addTo(map);
//property_layer.addData(testGeoJSon_properties, {onEachFeature: onEachFeature});











//L.geoJSON(testGeoJSon_properties).addTo(map);






    //var zones = L.geoJSON().addTo(map);
    //var locations = L.layerGroup(positions);
    //var boundaries = omnivore.kml(boundary_file, null, customLayer)

    //L.control.layers(baseMaps, overlayMaps).addTo(map);
    
    //omnivore.geojson('map.geojson').addTo(map);

    //L.geoJSON('map.geojson').addTo(map);
  
    //omnivore.kml(boundary_file).addTo(map);
    
    //AllPlanningAreas()

//var locations = L.layerGroup(positions);
//console.log(positions)

//var center = L.bounds([1.55, 104.12], [1.16, 103.50]).getCenter();
//var OneMap = L.map('map').setView([center.x, center.y], 12);
//console.log(center.x, center.y) // 1.355, 103.81
//var BaseMap = L.tileLayer("https://maps-{s}.onemap.sg/v3/Default/{z}/{x}/{y}.png", { //https://maps-{s}.onemap.sg/v3/Default/{z}/{x}/{y}.png
//    detectRetina: true, maxZoom: 18, minZoom: 11
//}).addTo(OneMap);

//showPosition(map, testlocationLatLong1);
//showPosition(map, testlocationLatLong2);

//var polygon = L.polygon([ [51.509, -0.08],[51.503, -0.06], [51.51, -0.047] ]).addTo(OneMap);
//var circle = L.circle([51.508, -0.11], { color: 'red', fillColor: '#f03', fillOpacity: 0.5, radius: 500 }).addTo(OneMap);
//marker = new L.Marker([position.coords.latitude, position.coords.longitude], {bounceOnAdd: false}).addTo(map);             
//var popup = L.popup();
  
//OneMap.on('locationfound', onLocationFound);
//map.on('click', onMapClick);

          

</script>
</body>
</html>